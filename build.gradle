buildscript {
    apply from: project.rootProject.relativePath('buildscript.gradle'), to: buildscript
}

apply plugin: 'com.athaydes.osgi-run'

allprojects {
    group 'com.neva.javarel'
    version "1.0.0.ALPHA"

    apply plugin: 'idea'
    apply plugin: 'base'

    repositories {
        mavenCentral()
        jcenter()
    }
}

dependencies {
    osgiRuntime 'org.slf4j:slf4j-log4j12:1.7.6'

    osgiRuntime 'org.apache.felix:org.apache.felix.http.bundle:2.3.2'
    osgiRuntime 'org.apache.felix:org.apache.felix.configadmin:1.8.8'
    osgiRuntime 'org.apache.felix:org.apache.felix.eventadmin:1.4.6'

    osgiRuntime 'commons-fileupload:commons-fileupload:1.3.1'
    osgiRuntime 'commons-io:commons-io:2.4'
    osgiRuntime 'org.json:json:20160212'
    osgiRuntime 'org.apache.felix:org.apache.felix.webconsole:4.2.14'
}

runOsgi {
    bundles += IPOJO_ALL_BUNDLES
    bundles += FELIX_GOGO_BUNDLES
    bundles += subprojects

    javaArgs = "-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005"
}

subprojects {

    plugins.withId 'osgi', {
        dependencies {
            compile 'org.jetbrains.kotlin:kotlin-osgi-bundle:1.0.0'

            compile 'org.osgi:org.osgi.enterprise:5.0.0'
            compile 'org.osgi:org.osgi.core:5.0.0'

            compile 'org.apache.felix:org.apache.felix.ipojo.annotations:1.12.1'
            compile 'javax.servlet:javax.servlet-api:3.0.1'

            testCompile group: 'junit', name: 'junit', version: '4.11'
        }
    }

}